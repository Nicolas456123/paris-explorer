<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paris Explorer - DÃ©couvrez tous les trÃ©sors de Paris</title>
    
    <!-- Meta SEO -->
    <meta name="description" content="Explorez Paris avec Paris Explorer ! DÃ©couvrez plus de 2000 lieux emblÃ©matiques, restaurants, monuments et secrets de la capitale franÃ§aise.">
    <meta name="keywords" content="Paris, exploration, monuments, restaurants, tourisme, guide, France">
    <meta name="author" content="Paris Explorer Team">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- IcÃ´nes -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/icon-16.png">
    <link rel="apple-touch-icon" sizes="192x192" href="assets/images/icon-192.png">
    
    <!-- Meta PWA -->
    <meta name="theme-color" content="#D4AF37">
    <meta name="background-color" content="#1e3a8a">
    <meta name="display" content="standalone">
    <meta name="orientation" content="portrait-primary">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin="">
    
    <!-- CSS Principal -->
    <link rel="stylesheet" href="assets/css/main.css?v=2.0.8">
    <link rel="stylesheet" href="assets/css/themes.css?v=2.0.8">
    <link rel="stylesheet" href="assets/css/responsive.css?v=2.0.8">
    
    <!-- Styles additionnels pour les suggestions de recherche -->
    <style>
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--paris-white);
            border: 2px solid var(--paris-gold);
            border-top: none;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        
        .suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition-fast);
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .suggestion-item:last-child {
            border-bottom: none;
        }
        
        .suggestion-item:hover,
        .suggestion-item.highlighted {
            background: rgba(212, 175, 55, 0.1);
            color: var(--paris-blue);
        }
        
        .suggestion-icon {
            opacity: 0.6;
            font-size: 14px;
        }
        
        .suggestion-text {
            flex: 1;
            font-weight: 500;
        }
        
        .suggestion-history {
            opacity: 0.4;
            font-size: 12px;
        }
        
        /* Styles pour les contrÃ´les de carte */
        .map-controls {
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 1000;
        }
        
        .map-controls .btn {
            padding: 8px 12px;
            min-width: auto;
            font-size: 14px;
            box-shadow: var(--shadow);
            border-radius: var(--border-radius);
        }
        
        /* Mode plein Ã©cran pour la carte */
        .map-fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
            border-radius: 0 !important;
        }
        
        .map-fullscreen .map-controls {
            top: 20px;
            right: 20px;
        }
        
        /* Fix critique pour les onglets mobiles */
        @media (max-width: 768px) {
            .tabs-container {
                position: fixed !important;
                left: 0 !important;
                right: 0 !important;
                z-index: 1000 !important;
                background: white !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
                padding: 8px !important;
                margin: 0 !important;
                /* Position calculÃ©e dynamiquement par JS */
            }
            
            /* RÃ©initialiser les hauteurs problÃ©matiques */
            .tab-content {
                padding-top: 16px !important;
                height: auto !important;
                min-height: 400px !important;
                overflow-y: visible !important;
                position: relative !important;
            }
            
            main {
                position: relative !important;
                /* Padding calculÃ© dynamiquement par JS */
            }
            
            /* S'assurer que le contenu est visible */
            .tab-content.active {
                display: block !important;
                visibility: visible !important;
            }
            
            /* CSS de dÃ©bogage mobile - contour rouge temporaire */
            .tab-content {
                border: 2px solid red !important;
                background-color: #fffaaa !important;
                margin-top: 10px !important;
            }
            
            main {
                border: 2px solid blue !important;
            }
            
            .tabs-container {
                border: 2px solid green !important;
            }
        }
    </style>
</head>
<body>
    <!-- Container Principal -->
    <div class="app-container">
        <!-- En-tÃªte -->
        <header class="header">
            <h1>ğŸ—¼ Paris Explorer</h1>
            <p class="subtitle">DÃ©couvrez tous les trÃ©sors de la Ville LumiÃ¨re</p>
        </header>
        
        <!-- Navigation et SÃ©lection Utilisateur -->
        <section class="nav-section">
            <div class="user-selector">
                <select id="userSelect" class="user-select">
                    <option value="">SÃ©lectionner un utilisateur...</option>
                </select>
                <button class="btn btn-primary" id="newUserBtn">ğŸ‘¤ Nouveau</button>
                <button class="btn btn-secondary" id="manageUsersBtn">âš™ï¸ GÃ©rer</button>
            </div>
            
            <!-- Recherche AvancÃ©e -->
            <div class="search-section">
                <div class="search-container" style="position: relative;">
                    <input type="text" id="searchInput" class="search-input" 
                           placeholder="ğŸ” Rechercher un lieu, monument, restaurant..." 
                           autocomplete="off">
                    <button class="search-btn" id="searchBtn">ğŸ”</button>
                    <button class="voice-search-btn" id="voiceSearchBtn" title="Recherche vocale">ğŸ¤</button>
                    
                    <!-- Container pour les suggestions (sera crÃ©Ã© dynamiquement) -->
                </div>
                
                <!-- Filtres AvancÃ©s -->
                <div class="filters-container">
                    <select id="arrondissementFilter" class="filter-select">
                        <option value="">Tous les arrondissements</option>
                    </select>
                    
                    <select id="categoryFilter" class="filter-select">
                        <option value="">Toutes les catÃ©gories</option>
                    </select>
                    
                    <select id="statusFilter" class="filter-select">
                        <option value="">Tous les statuts</option>
                        <option value="visited">âœ… VisitÃ©s</option>
                        <option value="not-visited">â­• Non visitÃ©s</option>
                        <option value="favorites">â­ Favoris</option>
                    </select>
                    
                    <div class="filter-actions">
                        <label class="checkbox-label">
                            <input type="checkbox" id="hideCompletedFilter">
                            Masquer les visitÃ©s
                        </label>
                        <button class="btn btn-sm btn-secondary" id="clearFiltersBtn">ğŸ—‘ï¸ Effacer</button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Onglets de Navigation -->
        <nav class="tabs-container">
            <button class="tab-btn active" data-tab="list">ğŸ“‹ Liste</button>
            <button class="tab-btn" data-tab="map">ğŸ—ºï¸ Carte</button>
            <button class="tab-btn" data-tab="favorites">â­ Favoris</button>
            <button class="tab-btn" data-tab="collections">ğŸ“š Collections</button>
            <button class="tab-btn" data-tab="stats">ğŸ“Š Statistiques</button>
            <button class="tab-btn" data-tab="achievements">ğŸ† SuccÃ¨s</button>
            <button class="tab-btn" data-tab="settings">âš™ï¸ ParamÃ¨tres</button>
            <button class="tab-btn" data-tab="users">ğŸ‘¥ Utilisateurs</button>
        </nav>
        
        <!-- Contenu des Onglets -->
        <main>
            <!-- Onglet Liste -->
            <div id="listContent" class="tab-content active">
                <div class="loading-message">
                    <div class="message-icon">ğŸ—¼</div>
                    <h3>Chargement des donnÃ©es parisiennes...</h3>
                    <p>PrÃ©paration de votre exploration de Paris</p>
                </div>
            </div>
            
            <!-- Onglet Carte -->
            <div id="mapContent" class="tab-content">
                <div id="mapContainer" style="position: relative;">
                    <!-- La carte Leaflet sera initialisÃ©e ici -->
                    <div class="map-loading" style="display: flex; align-items: center; justify-content: center; height: 100%; background: #a8d3f0; color: white; font-size: 1.2rem;">
                        ğŸ—ºï¸ Chargement de la carte de Paris...
                    </div>
                </div>
                
                <!-- ContrÃ´les de Carte -->
                <div class="map-controls">
                    <button class="btn btn-primary" id="fullscreenBtn" title="Plein Ã©cran">ğŸ”²</button>
                    <button class="btn btn-secondary" id="centerMapBtn" title="Centrer">ğŸ¯</button>
                </div>
            </div>
            
            <!-- Onglet Favoris -->
            <div id="favoritesContent" class="tab-content">
                <div class="empty-state">
                    <div class="empty-icon">â­</div>
                    <h3>Vos lieux favoris</h3>
                    <p>Ajoutez des lieux Ã  vos favoris en cliquant sur l'Ã©toile â˜†</p>
                </div>
            </div>
            
            <!-- Onglet Collections -->
            <div id="collectionsContent" class="tab-content">
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“š</div>
                    <h3>Vos collections personnalisÃ©es</h3>
                    <p>Organisez vos dÃ©couvertes par thÃ¨mes</p>
                </div>
            </div>
            
            <!-- Onglet Statistiques -->
            <div id="statsContent" class="tab-content">
                <div class="stats-loading">
                    <div class="message-icon">ğŸ“Š</div>
                    <h3>Calcul de vos statistiques...</h3>
                    <p>Analyse de votre progression parisienne</p>
                </div>
            </div>
            
            <!-- Onglet SuccÃ¨s -->
            <div id="achievementsContent" class="tab-content">
                <div class="achievements-loading">
                    <div class="message-icon">ğŸ†</div>
                    <h3>Vos succÃ¨s d'exploration</h3>
                    <p>DÃ©bloquez des achievements en explorant Paris !</p>
                </div>
            </div>
            
            <!-- Onglet ParamÃ¨tres -->
            <div id="settingsContent" class="tab-content">
                <div class="settings-loading">
                    <div class="message-icon">âš™ï¸</div>
                    <h3>Configuration de l'application</h3>
                    <p>Personnalisez votre expÃ©rience Paris Explorer</p>
                </div>
            </div>
            
            <!-- Onglet Gestion Utilisateurs -->
            <div id="usersContent" class="tab-content">
                <div class="users-loading">
                    <div class="message-icon">ğŸ‘¥</div>
                    <h3>Gestion des utilisateurs</h3>
                    <p>CrÃ©ez et gÃ©rez vos profils d'exploration</p>
                </div>
            </div>
        </main>
    </div>
    
    <!-- MODALS -->
    
    <!-- Modal CrÃ©ation/Gestion Utilisateur -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ‘¤ Gestion des Utilisateurs</h3>
                <button class="close-btn" id="closeUserModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="user-form">
                    <label for="userNameInput">Nom de l'utilisateur :</label>
                    <input type="text" id="userNameInput" class="form-input" 
                           placeholder="Entrez le nom du nouvel utilisateur..." maxlength="50">
                    <small class="setting-help">
                        Le nom d'utilisateur doit Ãªtre unique et ne peut pas Ãªtre modifiÃ©.
                    </small>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="window.createUser()">âœ¨ CrÃ©er l'utilisateur</button>
                    <button class="btn btn-secondary" onclick="app.uiManager.hideModal()">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Notes -->
    <div class="modal" id="noteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ“ Note Personnelle</h3>
                <button class="close-btn" id="closeNoteModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="note-form">
                    <label for="noteTextarea">Votre note :</label>
                    <textarea id="noteTextarea" class="form-textarea" 
                              placeholder="Ajoutez vos impressions, conseils ou souvenirs..."></textarea>
                </div>
                <div class="form-actions">
                    <button class="btn btn-primary" id="saveNoteBtn">ğŸ’¾ Sauvegarder</button>
                    <button class="btn btn-secondary" id="cancelNoteBtn">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal DÃ©tails Lieu -->
    <div class="modal" id="placeModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 class="modal-title" id="placeModalTitle">DÃ©tails du lieu</h3>
                <button class="close-btn" id="closePlaceModalBtn">&times;</button>
            </div>
            <div class="modal-body" id="placeModalContent">
                <!-- Le contenu sera gÃ©nÃ©rÃ© dynamiquement -->
            </div>
        </div>
    </div>
    
    <!-- Modal Import -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ“¥ Importer des donnÃ©es</h3>
                <button class="close-btn" onclick="app.uiManager.hideModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="import-section">
                    <h4>ğŸ“„ SÃ©lectionner le fichier</h4>
                    <input type="file" id="importFileInput" accept=".json" class="form-input">
                    <small class="setting-help">
                        Formats supportÃ©s : JSON (exportÃ© depuis Paris Explorer)
                    </small>
                </div>
                
                <div class="import-options">
                    <h4>âš™ï¸ Options d'import</h4>
                    <label class="checkbox-container">
                        <input type="checkbox" id="replaceDataCheckbox" checked>
                        <span class="checkmark"></span>
                        Remplacer les donnÃ©es existantes
                    </label>
                    <label class="checkbox-container">
                        <input type="checkbox" id="importSettingsCheckbox" checked>
                        <span class="checkmark"></span>
                        Importer les paramÃ¨tres
                    </label>
                    <label class="checkbox-container">
                        <input type="checkbox" id="importSearchHistoryCheckbox">
                        <span class="checkmark"></span>
                        Importer l'historique de recherche
                    </label>
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="app.exportImport.processImport()">
                        ğŸ“¥ Importer
                    </button>
                    <button class="btn btn-secondary" onclick="app.uiManager.hideModal()">
                        Annuler
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Container des Notifications -->
    <div class="notifications-container" id="notificationsContainer">
        <!-- Les notifications dynamiques apparaÃ®tront ici -->
    </div>
    
    <!-- Input cachÃ© pour l'import de fichiers -->
    <input type="file" id="hiddenImportInput" accept=".json" style="display: none;">
    
    <!-- Loading Spinner Global -->
    <div class="global-loading" id="globalLoading" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Chargement de Paris Explorer...</p>
            <small style="color: var(--paris-gray); margin-top: 10px;">
                PrÃ©paration de votre exploration parisienne
            </small>
        </div>
    </div>
    
    <!-- SCRIPTS -->
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    
    <!-- Modules JavaScript (dans le bon ordre) -->
    <script src="assets/js/utils.js?v=2.0.8"></script>
    <script src="assets/js/data-manager.js?v=2.0.8"></script>
    <script src="assets/js/user-manager.js?v=2.0.8"></script>
    <script src="assets/js/map-manager.js?v=2.0.8"></script>
    <script src="assets/js/search-filter.js?v=2.0.8"></script>
    <script src="assets/js/export-import.js?v=2.0.8"></script>
    <script src="assets/js/ui-manager.js?v=2.0.9"></script>
    <script src="assets/js/app.js?v=2.0.9"></script>
    
    <!-- Service Worker pour PWA -->
    <script>
        // Enregistrement du Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('âœ… Service Worker enregistrÃ©:', registration.scope);
                        
                        // Ã‰couter les mises Ã  jour
                        registration.addEventListener('updatefound', () => {
                            console.log('ğŸ†• Mise Ã  jour du Service Worker disponible');
                        });
                    })
                    .catch(registrationError => {
                        console.warn('âš ï¸ Ã‰chec enregistrement Service Worker:', registrationError);
                    });
            });
        }
        
        // Gestion de l'installation PWA
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('ğŸ“± PWA installable dÃ©tectÃ©e');
            e.preventDefault();
            deferredPrompt = e;
            
            // Afficher une notification d'installation aprÃ¨s un dÃ©lai
            setTimeout(() => {
                if (deferredPrompt && window.app) {
                    window.app.showNotification(
                        'ğŸ“± Installer Paris Explorer comme application ?',
                        'info',
                        10000,
                        [
                            { 
                                label: 'Installer', 
                                onclick: `
                                    deferredPrompt.prompt();
                                    deferredPrompt.userChoice.then((choiceResult) => {
                                        console.log(choiceResult.outcome === 'accepted' ? 'âœ… PWA installÃ©e' : 'âŒ Installation annulÃ©e');
                                        deferredPrompt = null;
                                    });
                                    this.parentElement.parentElement.remove();
                                `
                            },
                            { label: 'Plus tard', onclick: 'this.parentElement.parentElement.remove()' }
                        ]
                    );
                }
            }, 3000);
        });
        
        window.addEventListener('appinstalled', (evt) => {
            console.log('âœ… Paris Explorer installÃ© comme PWA');
            if (window.app) {
                window.app.showNotification('âœ… Paris Explorer installÃ© !', 'success');
            }
        });
        
        // Debug global
        window.debugParisExplorer = () => {
            if (window.app) {
                console.group('ğŸ—¼ Debug Paris Explorer');
                console.log('Version:', window.app.version);
                console.log('Ã‰tat:', window.app.getAppStatus());
                console.log('Utilisateurs:', Object.keys(window.app.userManager.users));
                console.log('DonnÃ©es chargÃ©es:', window.app.isDataLoaded);
                console.log('Total lieux:', window.app.dataManager?.getTotalPlaces());
                console.log('Recherche:', window.app.searchFilter?.getSearchStatistics());
                console.groupEnd();
            } else {
                console.log('âŒ Application non initialisÃ©e');
            }
        };
        
        // Message de bienvenue dans la console
        console.log(`
ğŸ—¼ Paris Explorer v2.0.1
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ Explorez plus de 2000 lieux parisiens
ğŸ¯ SystÃ¨me multi-utilisateurs avancÃ©  
ğŸ—ºï¸ Carte interactive Leaflet
ğŸ” Recherche et filtres intelligents
ğŸ“Š Suivi de progression dÃ©taillÃ©
ğŸ† SystÃ¨me d'achievements
ğŸ“± PWA avec mode hors-ligne
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’» Debug: window.debugParisExplorer()
ğŸ”§ Reset: window.ParisExplorer.reset()
        `);
    </script>
    
    <!-- Tracking et Analytics (dÃ©sactivÃ© par dÃ©faut) -->
    <!-- 
    <script>
        // Ajouter ici vos scripts d'analytics si nÃ©cessaire
        // Google Analytics, Matomo, etc.
    </script>
    -->
</body>
</html>
